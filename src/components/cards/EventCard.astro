---
import { formatEventDate, getRelativeTime } from '@/utils/formatDate';
import Icon from '@/components/ui/Icon.astro';

interface Props {
  title: string;
  date: Date;
  time?: string;
  location?: string;
  description: string;
  image?: string;
  slug: string;
  featured?: boolean;
  category?: string;
}

const {
  title,
  date,
  time,
  location,
  description,
  image,
  slug,
  featured = false,
  category,
} = Astro.props;

const relativeTime = getRelativeTime(date);
const isUpcoming = relativeTime === 'Today' || relativeTime === 'Tomorrow';
---

<article class:list={[
  'group bg-white rounded-2xl overflow-hidden shadow-soft hover:shadow-elevated transition-all duration-300',
  featured ? 'md:col-span-2 md:grid md:grid-cols-2' : '',
]}>
  {image ? (
    <div class="aspect-video overflow-hidden relative">
      <img
        src={image}
        alt=""
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
        loading="lazy"
        decoding="async"
      />
      {category && (
        <span class="absolute top-4 left-4 px-3 py-1 text-xs font-medium text-white bg-primary-900/80 rounded-full capitalize">
          {category}
        </span>
      )}
    </div>
  ) : (
    <div class="aspect-video bg-gradient-to-br from-primary-100 to-primary-200 flex items-center justify-center relative">
      <Icon name="calendar" size="xl" class="text-primary-400" />
      {category && (
        <span class="absolute top-4 left-4 px-3 py-1 text-xs font-medium text-primary-900 bg-white/90 rounded-full capitalize">
          {category}
        </span>
      )}
    </div>
  )}

  <div class="p-6">
    <!-- Date Badge -->
    <div class="flex items-center gap-3 mb-3">
      <div class="flex items-center gap-1.5 text-sm text-secondary-600 font-medium">
        <Icon name="calendar" size="sm" />
        <time datetime={date.toISOString()}>
          {formatEventDate(date)}
        </time>
      </div>
      {time && (
        <>
          <span class="text-neutral-300" aria-hidden="true">|</span>
          <div class="flex items-center gap-1.5 text-sm text-neutral-500">
            <Icon name="clock" size="sm" />
            <span>{time}</span>
          </div>
        </>
      )}
    </div>

    {isUpcoming && (
      <span class="inline-block px-2 py-0.5 text-xs font-medium text-secondary-700 bg-secondary-100 rounded mb-2">
        {relativeTime}
      </span>
    )}

    <h3 class="font-heading text-xl font-semibold text-primary-900 mb-2 group-hover:text-secondary-600 transition-colors">
      <a href={`/events/${slug}`} class="hover:underline">
        {title}
      </a>
    </h3>

    {location && (
      <p class="flex items-center gap-1.5 text-neutral-500 text-sm mb-3">
        <Icon name="map" size="sm" />
        <span>{location}</span>
      </p>
    )}

    <p class="text-neutral-600 line-clamp-2 mb-4">
      {description}
    </p>

    <a
      href={`/events/${slug}`}
      class="inline-flex items-center gap-1 text-secondary-600 font-medium hover:text-secondary-700 transition-colors group/link"
    >
      Learn More
      <Icon name="arrow-right" size="sm" class="group-hover/link:translate-x-1 transition-transform" />
    </a>
  </div>
</article>
