---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import Icon from '@/components/ui/Icon.astro';
import { getCollection, render } from 'astro:content';
import { formatDate } from '@/utils/formatDate';

export async function getStaticPaths() {
  const events = await getCollection('events');
  return events.map((event) => ({
    params: { slug: event.id },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);

const { title, date, time, endTime, location, description, image, category, registrationUrl } = event.data;
const formattedDate = formatDate(new Date(date));
---

<BaseLayout
  title={event.data.seoTitle || title}
  description={event.data.seoDescription || description}
>
  <!-- Hero -->
  <section class="relative py-20 md:py-28 bg-primary-900 text-white overflow-hidden">
    {image && (
      <>
        <img
          src={image}
          alt=""
          class="absolute inset-0 w-full h-full object-cover"
          aria-hidden="true"
        />
        <div class="absolute inset-0 bg-primary-950/75"></div>
      </>
    )}
    <Container class="relative z-10">
      <a
        href="/events"
        class="inline-flex items-center gap-2 text-primary-200 hover:text-white transition-colors mb-6"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Events
      </a>

      {category && (
        <span class="inline-block px-3 py-1 text-sm font-medium text-white bg-secondary-500 rounded-full mb-4 capitalize">
          {category}
        </span>
      )}

      <h1 class="text-4xl md:text-5xl lg:text-6xl font-heading font-semibold text-white mb-6">
        {title}
      </h1>

      <div class="flex flex-wrap gap-6 text-primary-100">
        <div class="flex items-center gap-2">
          <Icon name="calendar" />
          <time datetime={date.toISOString()}>{formattedDate}</time>
        </div>
        {time && (
          <div class="flex items-center gap-2">
            <Icon name="clock" />
            <span>{time}{endTime ? ` - ${endTime}` : ''}</span>
          </div>
        )}
        {location && (
          <div class="flex items-center gap-2">
            <Icon name="map" />
            <span>{location}</span>
          </div>
        )}
      </div>
    </Container>
  </section>

  <!-- Content -->
  <section class="py-20">
    <Container size="narrow">
      <div class="prose prose-lg max-w-none">
        <p class="text-xl text-neutral-600 mb-8 not-prose">
          {description}
        </p>
        <Content />
      </div>

      {registrationUrl && (
        <div class="mt-12 p-6 bg-secondary-50 rounded-2xl border border-secondary-200">
          <h3 class="font-heading text-xl font-semibold text-primary-900 mb-2">
            Registration Required
          </h3>
          <p class="text-neutral-600 mb-4">
            This event requires registration. Click below to sign up.
          </p>
          <Button href={registrationUrl} external>
            Register Now
            <Icon name="external" size="sm" />
          </Button>
        </div>
      )}

      <!-- Share & Contact -->
      <div class="mt-12 pt-8 border-t border-neutral-200">
        <div class="flex flex-wrap gap-4 justify-between items-center">
          <div>
            <p class="text-sm text-neutral-500 mb-2">Questions about this event?</p>
            <Button href="/contact" variant="outline" size="sm">
              Contact Us
            </Button>
          </div>
          <Button href="/events" variant="ghost" size="sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            All Events
          </Button>
        </div>
      </div>
    </Container>
  </section>
</BaseLayout>
